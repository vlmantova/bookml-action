# Compile with BookML

GitHub action for compiling LaTeX files to HTML using [BookML](https://vlmantova.github.io/bookml/).

## Basic usage

Add the file `.github/workflows/bookml.yaml` to your GitHub repository with the following content:
```YAML
on: push
jobs:
  build:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: Compile with BookML
        uses: vlmantova/bookml-action@v1
```
On every push, the action will checkout the repository, compile all .tex files containing the string `\documentclass`, then create a GitHub release containing all the outputs generated by BookML. The `permissions` key is necessary to create GitHub releases.

## What's new

- **v1.2.6** Major changes: capture and report multiline TeX error messages, and clarify that the outputs are also in the aux directory.

- **v1.2.5** Minor change: improve header of summary and release notes.

- **v1.2.4** Major change: much improved readability of error messages, with working links to the cause of the error when using the BookML Docker image v0.21.0 or later.

- **v1.2.3.** Major change: replace output messages in release with link to equivalent GitHub page.

- **v1.2.2.** Bugfix: truncate messages correctly to stay below 125000 character limit.

- **v1.2.1.** Bugfix: respect value of `inputs.checkout`.

- **v1.2.** Several improvements in user experience.
  - The release text includes direct links to each download and a link to the workflow run page on GitHub.
  - Error messages are highlighted in red in the workflow run page and are included prominently in the release text.
  - The workflow summary includes an abridged version of the release text.
  - **Breaking change**: custom values of `AUX_DIR` are ignored. This action sets its own value of `AUX_DIR` in order to compile the files in a temporary folder outside of the workspace.
  - **Breaking change**: the aux directory is now uploaded as job artifact rather than being attached to the release. This is essentially equivalent to the previous behaviour, except that artifacts normally expire after 90 days.

## Options

<dl>
<dt>checkout</dt><dd>Whether to checkout the repository calling this action. Default: <code>true</code> (boolean).</dd>
<dt>release</dt><dd>Whether to create a release containing the outputs generated by BookML. Default: <code>true</code> (boolean).</dd>
<dt>upload-aux-directory</dt><dd>Whether to upload the entire aux directory, which contains all outputs generated by BookML as well as logs and other intermediate files, into a GitHub artifact attached to the workflow run. Default: <code>true</code> (boolean).</dd>
<dt>scheme</dt><dd>Select which TeX Live scheme to use among basic, small, medium, full. Default: <code>'full'</code> (string).</dd>
<dt>version</dt><dd>Select which version of BookML to use. Note that this only affects which Docker image is used; if the <code>bookml/</code> folder is already present in the repository, that version of BookML will be used. Default: <code>'latest'</code> (string).</dd>
<dt>replace-bookml</dt><dd>Whether to replace the <code>bookml/</code> folder with the one included in the Docker image. Default: <code>false</code> (boolean).</dd>
<dt>timeout-minutes</dt><dd>The maximum number of minutes to run BookML before cancelling the build. Default: <code>6</code> (positive integer).</dd>
</dl>

For example, the following will use the BookML v0.19.3 Docker image, replace the `bookml/` folder with version v0.19.3, use the TeX Live scheme small, and set a longer timeout.
```YAML
- name: Compile with BookML
  uses: vlmantova/bookml-action@v1
  with:
    scheme: small
    version: v0.19.3
    replace-bookml: true
    timeout-minutes: 15
```

## Outputs

<dl>
  <dt>outputs</dt><dd>File names of all outputs compiled by BookML.</dd>
  <dt>targets</dt><dd>File names of all targets that BookML tried to compile.</dd>
  <dt>outcome</dt><dd>Compiling outcome (one of 'success', 'failure', 'timeout', 'invalid', 'cancelled').</dt>
  <dt>aux-directory-url</dt><dd>URL of GitHub artifact containing the aux directory (only if <code>upload-aux-directory</code> is true).</dd>
  <dt>release-url</dt><dd>URL of GitHub release (only if <code>release</code> is true).</dd>
</dl>
